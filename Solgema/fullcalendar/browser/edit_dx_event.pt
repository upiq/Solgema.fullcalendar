<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">
<head>
<metal:block fill-slot="javascript_head_slot">
<script type="text/javascript" tal:content="string: sf_goto_date='${view/isodate}'"></script>
<script type="text/javascript" tal:condition="python: not request.form.get('calendar_event_saved', None)">
(function ($) {
  $(document).ready( function() {
    $("iframe[name='SFEventEditIFRAME']", window.parent.document).height( $('#content').height()+30 );
    var $dialogContent = window.parent.$('#event_edit_container');
    $("#form-buttons-cancel").unbind('click').click(function () {
        window.parent.$('a.ui-dialog-titlebar-close').unbind('click').click(function (event){
          $dialogContent.dialog('close');
        });
        window.parent.$('a.ui-dialog-titlebar-close').click();
        return false;
    });
    $('ul.formTabs a').click(function(event){
      $("iframe[name='SFEventEditIFRAME']", window.parent.document).height( $("html").height()+30 );
    });
    $('select.formTabs').change(function(event){
      $("iframe[name='SFEventEditIFRAME']", window.parent.document).height( $("html").height()+30 );
    });
  });
}(jQuery));
</script>
<script tal:condition="python: request.form.get('calendar_event_saved', None)" type="text/javascript">
(function ($) {
  $(document).ready( function() {
    if (window.parent !== window) {
      window.parent.$('#calendar').empty().fullCalendar(window.parent.calendarOptions()); 
      if (window.sf_goto_date) {
        var dt = new Date(window.sf_goto_date);
        var year = 1900 + dt.getYear();
        var month = dt.getMonth();
        var day = dt.getDate();
        window.parent.$('#calendar').fullCalendar('gotoDate', year, month, day);
      }
      var dialogContent = window.parent.$('#event_edit_container');
      dialogContent.dialog('close');
    }
  });
}(jQuery));
</script>
<script type="text/javascript">
(function ($) {
  $(document).ready(function () {
    // optional support for plone.app.widgets, scan iframe document:
    if (require && require.defined('pat-registry')) {
      require('pat-registry').scan(document);
    }
  });
}(jQuery));
</script>
</metal:block>
<metal:block fill-slot="style_slot">
<style>
.template-sfajax_base_edit #portal-column-content {
  width: 100% !important;
  margin-left: 0px;
  left: 0;
}
</style>
</metal:block>

</head>
<body>
 <metal:block fill-slot="main">
 <div>
  <tal:block condition="python: not request.form.get('calendar_event_saved', None)">
    <metal:block use-macro="context/@@ploneform-macros/titlelessform" />
  </tal:block>
 </div>
 </metal:block>
</body>
</html>
